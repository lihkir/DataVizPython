

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Modelo predictivo con series de tiempo &#8212; Visualización de Datos con Python y R</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'predictive_model';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introducción a PostreSQL y Docker" href="postgresql.html" />
    <link rel="prev" title="Errores comunes al crear visualizaciones interactivas" href="common_errors.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo_uninorte.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo_uninorte.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="dataviz_intro.html">Introducción a la visualización de datos con Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="static_dataviz.html">Visualización estática</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_dataviz.html">De la visualización estática a la interactiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="stratified_dataviz.html">Visualización de datos a través de estratos</a></li>
<li class="toctree-l1"><a class="reference internal" href="geo_dataviz.html">Visualización interactiva de datos geográficos</a></li>
<li class="toctree-l1"><a class="reference internal" href="common_errors.html">Errores comunes al crear visualizaciones interactivas</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Modelo predictivo con series de tiempo</a></li>
<li class="toctree-l1"><a class="reference internal" href="postgresql.html">Introducción a PostreSQL y Docker</a></li>



<li class="toctree-l1"><a class="reference internal" href="dash_dataviz.html">Introducción a <code class="docutils literal notranslate"><span class="pre">Dash</span></code></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fpredictive_model.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/predictive_model.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Modelo predictivo con series de tiempo</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion-al-modelo-arima">Introducción al modelo ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementacion-del-modelo-arima">Implementación del modelo ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ejercicio-para-entregar">Ejercicio para entregar</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modelo-predictivo-con-series-de-tiempo">
<h1>Modelo predictivo con series de tiempo<a class="headerlink" href="#modelo-predictivo-con-series-de-tiempo" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p><strong>Definición:</strong>
Un <strong>proceso estocástico</strong> es una colección o familia de variables aleatorias <span class="math notranslate nohighlight">\(\{X_{t}\}_{t\in I}\)</span> ordenadas según el subíndice <span class="math notranslate nohighlight">\(t\)</span> que en general se suele identificar con el tiempo. Llamamos trayectoria del proceso a una realización del proceso estocástico. Si <span class="math notranslate nohighlight">\(I\)</span> es discreto, el proceso es en tiempo discreto. Si <span class="math notranslate nohighlight">\(I\)</span> es continuo, el proceso es en tiempo continuo.</p></li>
<li><p><strong>Observación:</strong></p>
<ul>
<li><p><em>Por tanto, para cada instante <span class="math notranslate nohighlight">\(t\)</span> tendremos una variable aleatoria distinta representada por <span class="math notranslate nohighlight">\(X_{t}\)</span>, con lo que un proceso estocástico puede interpretarse como una sucesión de variables aleatorias cuyas características pueden variar a lo largo del tiempo.</em></p></li>
<li><p><em>Un ejemplo de proceso en tiempo discreto se obtiene para <span class="math notranslate nohighlight">\(I = \{1,\dots,n\}\)</span>. En este caso, el proceso es <span class="math notranslate nohighlight">\(Y_{1}, Y_{2},\dots, Y_{n}\)</span>, y una trayectoria se denota por <span class="math notranslate nohighlight">\(y_{1}, y_{2},\dots, y_{n}\)</span>. Un ejemplo de proceso en tiempo continuo se obtiene para <span class="math notranslate nohighlight">\(I=[0, T], I=[0,\infty], I=(-\infty,\infty)\)</span></em></p></li>
</ul>
</li>
<li><p><strong>Definición:</strong> Una <strong>serie temporal</strong> es una realización parcial de un proceso estocástico de parámetro tiempo discreto, donde los elementos de <span class="math notranslate nohighlight">\(I\)</span> están ordenados y corresponden a instantes equidistantes del tiempo.</p></li>
</ul>
<figure class="align-center" id="stochastic-process-fig">
<a class="reference internal image-reference" href="_images/stochastic_process.png"><img alt="_images/stochastic_process.png" src="_images/stochastic_process.png" style="width: 303.75px; height: 86.85000000000001px;" /></a>
</figure>
<ul class="simple">
<li><p><strong>Definición:</strong> Un proceso estocástico <span class="math notranslate nohighlight">\((Y_{t})\)</span> es <strong>estacionario</strong> cuando las propiedades estadísticas de cualquier secuencia finita <span class="math notranslate nohighlight">\(Y_{t_{1}}, Y{t_{2}},\dots, Y{t_{n}}, (n\geq1)\)</span> de componentes de <span class="math notranslate nohighlight">\((Y_{t})\)</span> son semejantes a las de la secuencia <span class="math notranslate nohighlight">\(Y_{t_{1}+h}, Y_{t_{2}+h},\dots, Y_{t_{n}+h}\)</span> para cualquier número entero <span class="math notranslate nohighlight">\(h = \pm1, \pm2,\dots\)</span></p></li>
<li><p><strong>Definición:</strong> Un proceso estocástico <span class="math notranslate nohighlight">\((Y_{t})\)</span> es <strong>no estacionario</strong> cuando las propiedades estadísticas de al menos una secuencia finita <span class="math notranslate nohighlight">\(Y_{t_{1}}, Y{t_{2}},\dots, Y{t_{n}}, (n\geq1)\)</span> de componentes de <span class="math notranslate nohighlight">\((Y_{t})\)</span>, son diferentes de las de la secuencia <span class="math notranslate nohighlight">\(Y_{t_{1}+h}, Y_{t_{2}+h},\dots, Y_{t_{n}+h}\)</span> para al menos un número entero <span class="math notranslate nohighlight">\(h&gt;0\)</span>.</p></li>
<li><p><strong>Definición:</strong> La covarianza entre <span class="math notranslate nohighlight">\(y_{t}\)</span> y su valor en otro periodo de tiempo, digamos, <span class="math notranslate nohighlight">\(y_{t+k}\)</span> se denomina <strong>autocovarianza</strong> en el retardo <span class="math notranslate nohighlight">\(k\)</span>, y se define como</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\gamma_{k}=\text{Cov}(y_{t}, y_{t+k})=\text{E}[(y_{t}-\mu)(y_{t+k}-\mu)]\]</div>
<ul class="simple">
<li><p>La colección de los valores de <span class="math notranslate nohighlight">\(\gamma_{k}, k = 0, 1, 2,\dots\)</span> se denomina función de autocovarianza. Obsérvese que la autocovarianza en el lag <span class="math notranslate nohighlight">\(k = 0\)</span> es simplemente la varianza de la serie temporal; es decir, <span class="math notranslate nohighlight">\(\gamma_{0} = \sigma_{y}^{2}\)</span>, que es constante para una serie temporal estacionaria. El coeficiente de autocorrelación en el lag <span class="math notranslate nohighlight">\(k\)</span> para una serie temporal estacionaria es</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\rho_{k}=\frac{\text{E}[(y_{t}-\mu)(y_{t+k}-\mu)]}{\sqrt{\text{E}[(y_{t}-\mu)^{2}]\text{E}[(y_{t+k}-\mu)^{2}]}}=\frac{\text{Cov}(y_{t}, y_{t+k})}{\text{Var}(y_{t})}=\frac{\gamma_{k}}{\gamma_{0}}\]</div>
<ul class="simple">
<li><p>La colección de los valores de <span class="math notranslate nohighlight">\(\rho_{k}, k = 0, 1, 2,\dots\)</span> se llama <strong>función de autocorrelación (ACF)</strong>.</p></li>
<li><p><strong>Definición:</strong> Un <strong>modelo</strong> para un proceso estocástico es cualquier conjunto de hipótesis bien definidas sobre las propiedades estadísticas de dicho proceso.</p></li>
</ul>
<section id="introduccion-al-modelo-arima">
<h2>Introducción al modelo ARIMA<a class="headerlink" href="#introduccion-al-modelo-arima" title="Permalink to this heading">#</a></h2>
<ul>
<li><p>Los modelos <strong><code class="docutils literal notranslate"><span class="pre">ARIMA</span> <span class="pre">(Autorregresivo</span> <span class="pre">integrado</span> <span class="pre">de</span> <span class="pre">media</span> <span class="pre">móvil)</span></code></strong> aproximan los valores futuros de una serie temporal como una función lineal de observaciones pasadas y términos de ruido blanco. Una serie de tiempo <span class="math notranslate nohighlight">\(y_{t}\)</span> se llama un proceso de media móvil integrada autorregresiva (ARIMA) de órdenes <span class="math notranslate nohighlight">\(p, d\)</span>, y <span class="math notranslate nohighlight">\(q\)</span>, denotado ARIMA(<span class="math notranslate nohighlight">\(p, d, q\)</span>) si su diferencia <span class="math notranslate nohighlight">\(d\)</span> da lugar a un proceso estacionario ARMA(<span class="math notranslate nohighlight">\(p, q\)</span>). Por lo tanto, un ARIMA(<span class="math notranslate nohighlight">\(p, d, q\)</span>) puede escribirse como</p>
<div class="math notranslate nohighlight">
\[\Phi(B)(1-B)^{d}y_{t}=\delta+\Theta(B)\varepsilon_{t}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\Phi(B)=1-\sum_{i=1}^{p}\phi_{i}B^{i}\quad\text{and}\quad\Theta(B)=1-\sum_{i=1}^{q}\theta_{i}B^{i},\]</div>
<p>son los términos del operador back-shit en los AR(<span class="math notranslate nohighlight">\(p\)</span>) y MA(<span class="math notranslate nohighlight">\(q\)</span>) definidos como <span class="math notranslate nohighlight">\(\Phi(B)y_{t}=\delta+\varepsilon_{t}\)</span> y <span class="math notranslate nohighlight">\(y_{t}=\mu+\Theta(B)\varepsilon_{t}\)</span>, con <span class="math notranslate nohighlight">\(\delta=\mu-\phi\mu\)</span>, donde <span class="math notranslate nohighlight">\(\mu\)</span> es la media y <span class="math notranslate nohighlight">\(\varepsilon_{t}\)</span> el ruido blanco con <span class="math notranslate nohighlight">\(E(\varepsilon_{t})=0\)</span>.</p>
</li>
</ul>
<ul class="simple">
<li><p>Así, una vez realizada la diferenciación y una serie temporal estacionaria <span class="math notranslate nohighlight">\(w_{t}=(1-B)^{d}y_{t}\)</span> es obtenida, los métodos <em>autoregresivo</em> de orden <span class="math notranslate nohighlight">\(p\)</span>: AR(<span class="math notranslate nohighlight">\(p\)</span>) y <em>media movil</em>  de orden <span class="math notranslate nohighlight">\(q\)</span>: MA(<span class="math notranslate nohighlight">\(q\)</span>) pueden ser aplicados para tener un modelo completo.</p></li>
</ul>
</section>
<section id="implementacion-del-modelo-arima">
<h2>Implementación del modelo ARIMA<a class="headerlink" href="#implementacion-del-modelo-arima" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Durante esta sección estudiaremos el uso de las <strong>APIs</strong> para cargar datos de interes de estudio, los cuales en esta sección corresponden a series de tiempo financieras, especificamente la serie de tiempo de las acciones de <strong>Apple</strong> cotizadas en bolsas de valores será considerada.</p></li>
<li><p>En las secciones pasadas los datos eran cargados a un <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> usando la función <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> de <strong>Python</strong> utlizando el link de <code class="docutils literal notranslate"><span class="pre">github</span></code> en formato <code class="docutils literal notranslate"><span class="pre">raw</span></code> o simplemente con la dirección del directorio local donde reposaba el archivo en formato <em>CSV</em> que deseabamos cargar, en éste caso utlizaremos un protocolo de internet intermediario que nos permitirá obtener dichos datos.</p></li>
<li><p>Las series de tiempo financieras son de gran interés personal, pero estos modelos pueden ser aplicados a cualquier tipo de proceso discreto que requiera de predicciones para la correcta toma de decisiones.</p></li>
</ul>
<ul class="simple">
<li><p><strong>¿Qué es una API?</strong> <strong>API</strong> es el acrónimo de <strong>Application Programming Interface</strong> (Interfaz de Programación de Aplicaciones), que es un intermediario de software que permite que dos aplicaciones se comuniquen entre sí. Cada vez que usas una aplicación como Facebook, envías un mensaje instantáneo o consultas el tiempo en tu teléfono, estás usando una API. En su mayoría las <strong>API</strong> son privadas, algunas como la de <code class="docutils literal notranslate"><span class="pre">yahoo</span> <span class="pre">finance</span></code> son libres hasta cierto límite, y para cierto <code class="docutils literal notranslate"><span class="pre">futuros</span></code> y <code class="docutils literal notranslate"><span class="pre">derivados</span></code> especificos. Algunas entregan una versión de prueba, luego cuando la compañia que la ofrece nota un gran número de consultas (<code class="docutils literal notranslate"><span class="pre">queries</span></code>) por medio de su <strong>API</strong> a sus servidores desde una <strong>IP</strong> determinada, o de un <code class="docutils literal notranslate"><span class="pre">Bot</span></code> por ejemplo que hayas programado, comienzas a obtener mensajes de error direccionados a tu <strong>IP</strong> revocando la conexión. Otra opción interesante es <code class="docutils literal notranslate"><span class="pre">Quandl</span></code>, pero desafortunadamente ahora es adquisición de <code class="docutils literal notranslate"><span class="pre">Nasdaq</span></code> y lo más seguro es que exisitrán ciertos costos para el uso de la <strong>API</strong> que no existian antes. Una <strong>API</strong> que esperamos se mantenga gratuita es la de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code></p></li>
</ul>
<ul class="simple">
<li><p><strong>Finnhub Stock API:</strong> En esta sección estaremos utlizando la <strong>API</strong> de <a class="reference external" href="https://finnhub.io/">finnhub</a>. Finnhub proporciona una <strong>API</strong> de acciones en tiempo real gratuita para todos los operadores. También puede acceder a los datos de la empresa, el precio objetivo, las tendencias de recomendación, las ganancias y los datos de compensación de los directores generales a través de la <strong>API</strong>. Con la única misión de democratizar los datos financieros, <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> ofrece una <strong>API</strong> gratuita en tiempo real para <em>acciones, divisas y criptodivisas</em>. Con esta <strong>API</strong>, podrá acceder a datos en tiempo real de más de <strong>60 bolsas de valores, 10 corredores de divisas y más de 15 criptobolsas</strong>. También proporciona noticias en tiempo real para los mercados de empresas, acciones, divisas y criptomonedas. Los datos alternativos y de referencia de las empresas mundiales también se pueden recuperar a través de la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code>.</p></li>
</ul>
<ul class="simple">
<li><p>Para hacer uso de la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code>, debes crear una cuenta en su sitio web utilizando el correo de tu preferencia. Al crear tu cuenta automáticamente se generará una <strong>API Key</strong> que te permitirá ha cer uso de la <strong>API</strong>. Esta <strong>API Key</strong> es privada, la puedes volver a generar si la pierdes o si si está siendo usada por otra persona. La siguiente es una imágen del <strong>Dashboard</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> donde aparece tu <strong>API Key</strong>. Puedes hacer uso de <strong>Sandbox API Key</strong> para reducir el coste y el riesgo asociados a las llamadas a <strong>API</strong> de terceros durante los tests y permitir el desarrollo simultáneos para acelerar los ciclos de desarrollo de aplicaciones y reducir el <em>time-to-market</em>. Se utiliza para probar programas sospechosos que pueden contener virus u otro malware, sin permitir que el software dañe los dispositivos anfitriones. También puede usar el <strong>Webhook</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code>, como método de alteración del funcionamiento de una página o aplicación web, con callbacks personalizados. Es esta sección utlizaremos sólo la <strong>API Key</strong>, el resto de funcionalidades las podrá experimentar en los informes o proyectos finales. Para mas información acerca de la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> visitar la documentación correspondiente en su sitio web: <a class="reference external" href="https://finnhub.io/docs/api">https://finnhub.io/docs/api</a></p></li>
</ul>
<p><img alt="" src="_images/API.png" /></p>
<ul class="simple">
<li><p>Para usar la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> desde su notebook, deberá primero instalar usando el gestor de instalación <strong>pip</strong> la librería de <strong>Python</strong> requerida para hacer uso de la <strong>API</strong> usando la orden: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">finnhub-python</span></code>. Luego de hacer esto puede comenzar a usar las diferentes funciones públicas asociadas a la clase <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> que importamos desde <strong>Python</strong> luego de la isntalación. También importaremos librería para conversiones de <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code> a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> que realizará conversiones a un formato de fecha conocido, a saber: año, mes, día <code class="docutils literal notranslate"><span class="pre">%Y-%m-%d</span></code>. Las librerías <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> y <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> ya usadas en anteriores secciones también son importadas para realizar los gráficos correspondientes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">finnhub</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">mktime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>La librería <code class="docutils literal notranslate"><span class="pre">warnings</span></code> es utlizada para evitar múltiples mensaje molestos de alertas no fatales, que en gran parte de los casos están relacionados con diferentes versiones de la librería en uso.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Usamos las funciones <code class="docutils literal notranslate"><span class="pre">set_theme()</span></code> para configurar el tema a usar en las figuras, en éste caso <code class="docutils literal notranslate"><span class="pre">paper</span></code> el cual invocamos usando <code class="docutils literal notranslate"><span class="pre">set_context(&quot;paper&quot;)</span></code>. Para ver más temas para figuras con <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> visitar: <a class="reference external" href="http://seaborn.pydata.org/tutorial/aesthetics.html">http://seaborn.pydata.org/tutorial/aesthetics.html</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>En la siguiente línea hacemos usa de la función <code class="docutils literal notranslate"><span class="pre">Client</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> que se encarga de realizar la conexión con el cliente <code class="docutils literal notranslate"><span class="pre">finnhub</span></code>, utlizando nuesta <strong>API Key</strong> y crea un objeto instanciado que podemos usar para hacer uso de toda la funcionalidad ofrecida por la <strong>API</strong>. Debe escribir la <strong>API</strong> correctamente y entre comillas para que se realice correctamente la conexión. Dependiendo de su conexión a internet y su computadora, puede obtener mensajes de <em>delay</em> por parte del cliente, en estos caso simplemente vuelva a ejecutar la conexión con su <strong>API</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">finnhub_client</span> <span class="o">=</span> <span class="n">finnhub</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;c5g56siad3id0d5no4vg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Seleccione el stock de interés. Para éste ejemplo consideramos el precio de las acciones de <strong>AAPL</strong> con un <em>timeframe</em> diario. La función <code class="docutils literal notranslate"><span class="pre">datetime.now()</span></code> nos entrega la fecha y hora actual, la función <code class="docutils literal notranslate"><span class="pre">timedelta()</span></code> nos entrega en tiempo cero, 365 días del año que vamos a restar de la fecha actual. Esto es nuestra serie de tiempo corresponde a los últimos 365 precios de las acciones de <strong>Apple</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stock</span> <span class="o">=</span> <span class="s1">&#39;AAPL&#39;</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>

<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Para obtener información de nuestra vela de precios (<strong>candlestick</strong>) procedemos a hacer uso de la función <code class="docutils literal notranslate"><span class="pre">stock_candles</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">finnhub_client</span></code> para poder obtener información en la vela. Normalemente esta información corresponde al precio al que la acción en en día indicado, abrió, cerró, su valor máximo y mínimo, volumen tradeado y el tiempo dado en días en éste caso. Para aplicaciones avanzadas como las de <strong>HFT</strong>, que necesitan los precios a una frecuencia más alta cambiaríamos la resolución <code class="docutils literal notranslate"><span class="pre">resolution</span> <span class="pre">=</span> <span class="pre">'D'</span></code> a la resolución que necesite, puede realizar hasta 60 llamados por minuto. La función <code class="docutils literal notranslate"><span class="pre">.timestamp</span></code> nos permitirá obtener nuestra fecha en formato <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code>, único formato que aceptará la función <code class="docutils literal notranslate"><span class="pre">stock_candles</span></code>. Imprima alguno de estos códigos <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code> y utilice la siguiente calculadora <a class="reference external" href="https://www.epochconverter.com/">https://www.epochconverter.com/</a> para verificar por ejemplo el código de la fecha y hora actual. Observe que la columna <code class="docutils literal notranslate"><span class="pre">t</span></code> del <strong>DataFrame</strong> viene en formato <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code>. Además nótese que se realizó un cambio de formato a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, esto es porque el formato original que viene de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> es tipo <strong>JSON</strong>. Para facilitar el desarrollo de esta sección transformamos éste objeto <strong>JSON</strong> a un <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <strong>DataFrame</strong>. Cada <em>key</em> del archivo <strong>JSON</strong> corresponde a los combres de cada columna y el <em>value</em>, es una lista con los 365 datos correspondientes a la columna</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

<span class="n">AAPL_res</span> <span class="o">=</span> <span class="n">finnhub_client</span><span class="o">.</span><span class="n">stock_candles</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="n">AAPL_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">AAPL_res</span><span class="p">)</span>

<span class="n">AAPL_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c</th>
      <th>h</th>
      <th>l</th>
      <th>o</th>
      <th>s</th>
      <th>t</th>
      <th>v</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>144.80</td>
      <td>149.046</td>
      <td>144.13</td>
      <td>148.070</td>
      <td>ok</td>
      <td>1666828800</td>
      <td>109180150</td>
    </tr>
    <tr>
      <th>1</th>
      <td>155.74</td>
      <td>157.500</td>
      <td>147.82</td>
      <td>148.200</td>
      <td>ok</td>
      <td>1666915200</td>
      <td>164762371</td>
    </tr>
    <tr>
      <th>2</th>
      <td>153.34</td>
      <td>154.240</td>
      <td>151.92</td>
      <td>153.155</td>
      <td>ok</td>
      <td>1667174400</td>
      <td>97943171</td>
    </tr>
    <tr>
      <th>3</th>
      <td>150.65</td>
      <td>155.450</td>
      <td>149.13</td>
      <td>155.080</td>
      <td>ok</td>
      <td>1667260800</td>
      <td>80379345</td>
    </tr>
    <tr>
      <th>4</th>
      <td>145.03</td>
      <td>152.170</td>
      <td>145.00</td>
      <td>148.945</td>
      <td>ok</td>
      <td>1667347200</td>
      <td>93604623</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>La siguiente función la utlilizaremos para convertir de formato <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code> a <code class="docutils literal notranslate"><span class="pre">datetime</span></code>, la columna <code class="docutils literal notranslate"><span class="pre">t</span></code> de la fecha en nuestr <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">AAPL_df</span></code>. Para aplicar la función a cada valor de la columna <code class="docutils literal notranslate"><span class="pre">t</span></code> usamos la función <code class="docutils literal notranslate"><span class="pre">apply</span></code>, estudiada anteriormente. Presentamos un ejemplo para que podamos visualizar el funcionamiento de la función <code class="docutils literal notranslate"><span class="pre">date_format</span></code> que recibirá como argumento un código <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">time</span></code> y lo transformará a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> usando la función <code class="docutils literal notranslate"><span class="pre">datetime.fromtimestamp()</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">date_format</span><span class="p">(</span><span class="n">date_col</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">date_col</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_format</span><span class="p">(</span><span class="mi">1602460800</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2020-10-11&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AAPL_df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>
<span class="n">AAPL_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c</th>
      <th>h</th>
      <th>l</th>
      <th>o</th>
      <th>s</th>
      <th>t</th>
      <th>v</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>144.80</td>
      <td>149.046</td>
      <td>144.13</td>
      <td>148.070</td>
      <td>ok</td>
      <td>2022-10-26</td>
      <td>109180150</td>
    </tr>
    <tr>
      <th>1</th>
      <td>155.74</td>
      <td>157.500</td>
      <td>147.82</td>
      <td>148.200</td>
      <td>ok</td>
      <td>2022-10-27</td>
      <td>164762371</td>
    </tr>
    <tr>
      <th>2</th>
      <td>153.34</td>
      <td>154.240</td>
      <td>151.92</td>
      <td>153.155</td>
      <td>ok</td>
      <td>2022-10-30</td>
      <td>97943171</td>
    </tr>
    <tr>
      <th>3</th>
      <td>150.65</td>
      <td>155.450</td>
      <td>149.13</td>
      <td>155.080</td>
      <td>ok</td>
      <td>2022-10-31</td>
      <td>80379345</td>
    </tr>
    <tr>
      <th>4</th>
      <td>145.03</td>
      <td>152.170</td>
      <td>145.00</td>
      <td>148.945</td>
      <td>ok</td>
      <td>2022-11-01</td>
      <td>93604623</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Luego cambiamos los nombres de cada columna (iniciales) al nombre original que se utiliza en los <code class="docutils literal notranslate"><span class="pre">candlesticks</span> <span class="pre">de</span> <span class="pre">series</span> <span class="pre">de</span> <span class="pre">tiempo</span> <span class="pre">financieras</span></code>, como se muestra en la siguiente figura. Eliminamos la columna <code class="docutils literal notranslate"><span class="pre">s</span></code> que no proporciona información relevante para las predicciones. Utilizaremos la función <code class="docutils literal notranslate"><span class="pre">rename</span></code> y <code class="docutils literal notranslate"><span class="pre">drop</span></code> ya usadas anteriormente con éste objetivo. Consideraremos para éste ejemplo el <code class="docutils literal notranslate"><span class="pre">precio</span> <span class="pre">de</span> <span class="pre">cierre</span> <span class="pre">de</span> <span class="pre">la</span> <span class="pre">acción</span></code>, debido a que es el más utilizado cuando deseamos tomar decisiones de inversión</p></li>
</ul>
<figure class="align-center" id="candletick-fig">
<img alt="_images/candletick.png" src="_images/candletick.png" />
</figure>
<ul class="simple">
<li><p>La siguiente figura es extraida de <a class="reference external" href="https://www.tradingview.com/">tradingview</a>, y representa el precio diario de las acciones de <strong>APPLE</strong> cotizadas en <strong>Nasdaq</strong> uno de los principales exchange de futuros y derivados <strong>in the Street</strong>. Distintas predicciones se pueden realizar por medio del uso de <strong>análisis técnico</strong> y <strong>análisis fundamental</strong> por ejemplo. En éste caso usaremos el modelo <strong>ARIMA</strong> como herramienta predictiva para horizontes cortos. Si desea experimentar un poco el análisis técnico realizado por aproximadamente un 90% de los traders, recomiendo usar <strong>Bitmex Testnet</strong> e iniciar con una wallet con <strong>Bitcoins</strong> de prueba (<em>paper version</em>), para adquirir destrezas antes de realizar alguna inversión, el análisis técnico es una técnica que requiere de muchos años de experiencia y disciplina para obtener resultados exitosos.</p></li>
</ul>
<figure class="align-center" id="aapl-tradingview-fig">
<img alt="_images/AAPL_tradingview.png" src="_images/AAPL_tradingview.png" />
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;Close&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="s1">&#39;High&#39;</span><span class="p">,</span><span class="s1">&#39;l&#39;</span><span class="p">:</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">:</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="s1">&#39;Volume&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">AAPL_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">AAPL_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Close</th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Date</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>144.80</td>
      <td>149.046</td>
      <td>144.13</td>
      <td>148.070</td>
      <td>2022-10-26</td>
      <td>109180150</td>
    </tr>
    <tr>
      <th>1</th>
      <td>155.74</td>
      <td>157.500</td>
      <td>147.82</td>
      <td>148.200</td>
      <td>2022-10-27</td>
      <td>164762371</td>
    </tr>
    <tr>
      <th>2</th>
      <td>153.34</td>
      <td>154.240</td>
      <td>151.92</td>
      <td>153.155</td>
      <td>2022-10-30</td>
      <td>97943171</td>
    </tr>
    <tr>
      <th>3</th>
      <td>150.65</td>
      <td>155.450</td>
      <td>149.13</td>
      <td>155.080</td>
      <td>2022-10-31</td>
      <td>80379345</td>
    </tr>
    <tr>
      <th>4</th>
      <td>145.03</td>
      <td>152.170</td>
      <td>145.00</td>
      <td>148.945</td>
      <td>2022-11-01</td>
      <td>93604623</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Utilizaremos la función <code class="docutils literal notranslate"><span class="pre">lineplot</span></code> de <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> para realizar un gráfico de la serie de tiempo de interés. Dado que el volumen de datos es amplio, para poder visualizar fechas en el eje <span class="math notranslate nohighlight">\(x\)</span> por ejemplo usamos la función <code class="docutils literal notranslate"><span class="pre">get_xticks()</span></code> para obtener estas fechas cambiar la frecuencia a ser colocada <strong>solo</strong> en la figura, para poder tener una visualización agradable a la vista. Dado que los nombres de cada etiqueta corresponden a strings de fechas, para evitar que queden uno sobre otro, rotamos los labels en éste eje usano la función <code class="docutils literal notranslate"><span class="pre">plt.xticks(rotation=50)</span></code>, nótese que se ha colocado <code class="docutils literal notranslate"><span class="pre">;</span></code> al final de éste llamado, <strong>¿Con que objetivo?</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">AAPL_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Close&quot;</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c090b7351957e567463bd86305cc5a1633ef1f1f7ea942127a0941389a95661c.png" src="_images/c090b7351957e567463bd86305cc5a1633ef1f1f7ea942127a0941389a95661c.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Gráficos de velas en Python:</strong> El gráfico de velas es un estilo de gráfico financiero que describe la apertura, el máximo, el mínimo y el cierre para una coordenada <span class="math notranslate nohighlight">\(x\)</span> determinada (probablemente la hora). Los recuadros representan la dispersión entre los valores de apertura y cierre y las líneas representan la dispersión entre los valores bajos y altos. Los puntos de muestra en los que el valor de cierre es mayor (menor) que el de apertura se denominan crecientes (decrecientes). Por defecto, las velas crecientes se dibujan en verde mientras que las decrecientes se dibujan en rojo. Para realizar la figura usamos la función <code class="docutils literal notranslate"><span class="pre">Figure()</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">go</span></code> de <code class="docutils literal notranslate"><span class="pre">plotly</span></code>, esta función recibe como input los datos asociados al candlestick suministrados por medio de la función <code class="docutils literal notranslate"><span class="pre">Candlestick</span></code> también de la clase <code class="docutils literal notranslate"><span class="pre">go</span></code> de <code class="docutils literal notranslate"><span class="pre">plotly</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Candlestick</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span>
                                     <span class="nb">open</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Open</span><span class="p">,</span> 
                                     <span class="n">high</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">High</span><span class="p">,</span>
                                     <span class="n">low</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Low</span><span class="p">,</span> 
                                     <span class="n">close</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
                     <span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Apple Inc. (AAPL)&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;AAPL-USD&quot;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New, monospace&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;RebeccaPurple&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_rangeslider_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<ul class="simple">
<li><p>Utilizaremos ahora una prueba estadística para verificar si la serie de tiempo es estacionaria o no. Esta prueba es la de  <code class="docutils literal notranslate"><span class="pre">Dickey-Fuller</span></code>. En cursos avanzados de <strong>series de tiempo</strong> se estudia estadísticamente éste tipo de pruebas así como los plots <strong>ACF</strong> y <strong>PACF</strong>, en esta sección sólo mencionaremos en una bastante resumida la idea detras de su uso. Para hacer uso de esta prueba importamos la función <code class="docutils literal notranslate"><span class="pre">adfuller</span></code> de la clase <code class="docutils literal notranslate"><span class="pre">statsmodels.tsa.stattools</span></code>. Para aplicar el test pasamos los datos del precio de cierre, serie de tiempo de interés, usando <code class="docutils literal notranslate"><span class="pre">AAPL_df.Close</span></code>. Éste será el argumento de la función <code class="docutils literal notranslate"><span class="pre">adfuller</span></code> encargada de realizar el test de <code class="docutils literal notranslate"><span class="pre">Dickey-Fuller</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">log</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -1.155377
p-value: 0.692491
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Dado que el valor crítico, el estadístico <code class="docutils literal notranslate"><span class="pre">ADF</span> <span class="pre">=-1,8</span> <span class="pre">&gt;</span> <span class="pre">-2,5,-3,4,-2,8</span></code> (valores <span class="math notranslate nohighlight">\(t\)</span> en intervalos de confianza de 1%,5% y 10%), se acepta la hipótesis nula <span class="math notranslate nohighlight">\((H_{o})\)</span></p></li>
<li><p>Valor <span class="math notranslate nohighlight">\(p-\)</span><code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">0,480737</span> <span class="pre">&gt;</span> <span class="pre">0,05</span></code>. Dado que el valor <span class="math notranslate nohighlight">\(p\)</span> de Adfuller es mayor que un determinado valor alfa especificado (5%, nivel de significación o intervalo de confianza del 95%), se acepta la hipótesis nula <span class="math notranslate nohighlight">\((H_{o})\)</span>, es decir, la serie temporal no es estacionaria</p></li>
</ul>
<ul class="simple">
<li><p>Realizaremos ahora figuras de <strong>autocorrelación</strong> para confirmar que la serie de tiempo es estacionaria, así como también para verificar cual es el orden de integración necesario para llevar nuestra serie de tiempo no estacionaria a una estacionaría. Para esto usaremos la función <code class="docutils literal notranslate"><span class="pre">plot_acf</span></code> de <strong>Python</strong>, la cual recibe como argumentos, la serie de tiempo de interés y el número de <em>lags</em>* que deseamos considerar en la figura. Nótese que utlizamos la función <code class="docutils literal notranslate"><span class="pre">.diff()</span></code> para realizar diferenciación en nuestra serie de tiempo, con el objetivo de remover tendencia, además nótese también que se eliminan valores <code class="docutils literal notranslate"><span class="pre">nan</span></code> que podamos obtener en éste proceso debido a que está figura consiste en graficar todos los valores <span class="math notranslate nohighlight">\(\rho_{k}\)</span> definidos anteriormente, donde aparece un cociente para el cual evitamos valores nulos en el denominador. Realizaremos tres figuras, correspondientes a la autocorrelación de la serie original, la serie diferenciada una vez, y dos veces. Colocaremos estas figuras en una matriz de <span class="math notranslate nohighlight">\(3\times2\)</span> usando la función <code class="docutils literal notranslate"><span class="pre">fig,</span> <span class="pre">axes</span> <span class="pre">=</span> <span class="pre">plt.subplots(3,</span> <span class="pre">2,</span> <span class="pre">sharex=True)</span></code> de <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>. Para que cree que se usa el llamado <code class="docutils literal notranslate"><span class="pre">sharex=True</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">);</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Series&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">240</span><span class="p">);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1st Order Differencing&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">240</span><span class="p">);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2nd Order Differencing&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">240</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c6721f652ea396a634f3b548809645540cffe8a3a6d11a01245626e8f91a40e1.png" src="_images/c6721f652ea396a634f3b548809645540cffe8a3a6d11a01245626e8f91a40e1.png" />
</div>
</div>
<ul class="simple">
<li><p>Nótese el <strong>decaimiento geométrico</strong> en la primera figura de autocorrelación, que baja desde la parte positiva con una tendencia lineal, la cual es interpretada como una autocorrelación asociada a una serie de tiempo no estacionaría como indica la prueba de <code class="docutils literal notranslate"><span class="pre">Dickey-Fuller</span></code> que presenta efectivamente tendencias. Los intervalos de confianza se dibujan como un cono. Por defecto, se establece un intervalo de confianza del 95%. Al observar el gráfico de autocorrelación para la segunda diferenciación, el retardo entra en la zona negativa con bastante rapidez, lo que indica que la serie podría haber sido sobrediferenciada.</p></li>
</ul>
<ul class="simple">
<li><p>Definimos ahora nuestro conjuntos de entrenamiento y testeo para el modelo <strong>ARIMA</strong>, en éste caso nuestro <strong>test</strong> corresponde a los últimos 7 precios de las acciones de <strong>AAPL</strong>, y el <strong>train</strong> corresponde a la serie de tiempo original menos estos 7 días. El mejor modelo será obtenido mediante uso de los datos de entrenamiento y el criterio de <strong>Akaike</strong> y de <strong>inferencia Bayesiana</strong> el cual penaliza la suma de los residuos al cuadrado por incluir parámetros adicionales en el modelo, los modelos que tienen valores pequeños del <strong>AIC</strong> o <strong>BIC</strong> se consideran buenos modelos. El primer término del AIC o BIC es la función de <strong>verosimilitud</strong> para el modelo ajustado evaluada en las estimaciones de <strong>máxima verosimilitud</strong> de los parámetros desconocidos. En este contexto, <strong>AIC y SIC</strong> se denominan <strong>criterios de verosimilitud penalizados</strong>. En esta sección seleccionaremos el modelo con el menor <strong>AIC</strong> debido a que el <strong>AIC</strong> es <strong>asintóticamente eficiente</strong> (<em>menor error de predicción en nuevos datos</em>) pero el <strong>BIC</strong> no lo es. Más sobre esta técnica y el principio de máxima verosimilitud para selecciona de un buen modelo <strong>ARIMA</strong>, es abordado en cursos electivos de <strong>análisis de series de tiempo</strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[AIC=\ln\left(\frac{\sum_{t=1}^{T}e_{t}^{2}}{T}\right)+\frac{2p}{T},\quad BIC=\ln\left(\frac{\sum_{t=1}^{T}e_{t}^{2}}{T}\right)+\frac{p\ln(T)}{T}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_AAPL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># This can be changed</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_AAPL</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_1w</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_1w</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train:&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test_1w:&quot;</span><span class="p">,</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>train: (244,)
test_1w: (7,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="p">[[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Close&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_1w_df</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="p">[[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Close&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Utlizamos ahora el modelo <code class="docutils literal notranslate"><span class="pre">ARIMA</span></code> importado desde la librería <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> de <strong>Python</strong> para obetener distintos <strong>ARIMA</strong> de ordenes <span class="math notranslate nohighlight">\(p,d,q\)</span>. Consideramos <code class="docutils literal notranslate"><span class="pre">method</span> <span class="pre">=</span> <span class="pre">'mle'</span></code> para el cálculo de la <strong>verosimilitud</strong> exacta a través del <strong>filtro de Kalman</strong>. Como ejercicio puede reescribir estas líneas de código en una función que dependa sólo del input <code class="docutils literal notranslate"><span class="pre">train</span></code> y retorne los ordenes <span class="math notranslate nohighlight">\(p, d, q\)</span> asociados al criterio <strong>AIC</strong> de bondad de ajuste</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_aic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_bic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mdl</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">pq_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">d_rng</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># print(i, d, j)</span>
                <span class="n">tmp_mdl</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="n">tmp_aic</span> <span class="o">=</span> <span class="n">tmp_mdl</span><span class="o">.</span><span class="n">aic</span>
                <span class="k">if</span> <span class="n">tmp_aic</span> <span class="o">&lt;</span> <span class="n">best_aic</span><span class="p">:</span>
                    <span class="n">best_aic</span> <span class="o">=</span> <span class="n">tmp_aic</span>
                    <span class="n">best_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">best_mdl</span> <span class="o">=</span> <span class="n">tmp_mdl</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">continue</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;aic: </span><span class="si">{:6.5f}</span><span class="s1"> | order: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">best_aic</span><span class="p">,</span> <span class="n">best_order</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>aic: 1146.89411 | order: (1, 1, 1)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Existe una función llamada <code class="docutils literal notranslate"><span class="pre">auto_arima</span></code> de <strong>Python</strong> la cual es útli en ciertos casos especificos. Éste no es uno de ellos dado que el modelo <strong>ARIMA</strong> que entrega es un simple random walk <span class="math notranslate nohighlight">\(x_{t}=x_{t-1}+\omega_{t}\)</span>, el cual predice puramente como un modelo estocástico con dependencia temporal basado totalmente en el punto temporal anterior <span class="math notranslate nohighlight">\(t-1\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">arima</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>       <span class="c1"># use adftest to find optimal &#39;d&#39;</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="c1"># maximum p and q</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>              <span class="c1"># frequency of series</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>           <span class="c1"># let model determine &#39;d&#39;</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>   <span class="c1"># No Seasonality</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>  
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,1,1)(0,0,0)[0] intercept   : AIC=inf, Time=0.06 sec
 ARIMA(0,1,0)(0,0,0)[0] intercept   : AIC=1152.475, Time=0.00 sec
 ARIMA(1,1,0)(0,0,0)[0] intercept   : AIC=1153.470, Time=0.01 sec
 ARIMA(0,1,1)(0,0,0)[0] intercept   : AIC=1153.310, Time=0.02 sec
 ARIMA(0,1,0)(0,0,0)[0]             : AIC=1151.126, Time=0.01 sec

Best model:  ARIMA(0,1,0)(0,0,0)[0]          
Total fit time: 0.095 seconds
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Por lo tanto para éste problema consideramos los mejores ordenes <span class="math notranslate nohighlight">\(p, d, q\)</span> obtenidos a a partir del criterio de Akaike. Los usamos como argumento de entrada en nuestro modelo <strong>ARIMA</strong> junto a nuestro <em>train set</em>, para obtener el modelo de ajustado de interés que utlizaremos para predecir valores futuros usando <em>rolling</em></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_predict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Para graficar el ajuste de nuestro modelo <strong>ARIMA</strong> frente a nuestro conjunto de entrenamiento utilizamos la función <code class="docutils literal notranslate"><span class="pre">plot_predict</span></code> que proviene del objeto instanciado usando la función <strong>ARIMA</strong>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plot_predict</span><span class="p">(</span><span class="n">model_fit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1200x800 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/ed0e711b6f37f390edc16303285334435e2542d566f6e16e5765da975c93ec54.png" src="_images/ed0e711b6f37f390edc16303285334435e2542d566f6e16e5765da975c93ec54.png" />
</div>
</div>
<ul class="simple">
<li><p>Para medir el error de predicción cometido en las predicciones, utilizaremos las métricas usuales en análisis de series de tiempo: <code class="docutils literal notranslate"><span class="pre">MAPE,</span> <span class="pre">MAE,</span> <span class="pre">RMSE,</span> <span class="pre">MSE</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">):</span>
    
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                 <span class="c1"># MAE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span>               <span class="c1"># RMSE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>                    <span class="c1"># MSE</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
    
    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
                           <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
                           <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
                           <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
                           <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">]},</span>
                          <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Realizamos ahora predicciones utlilizando <em>rolling forecasting</em>. El <em>rolling forecast</em> entrega reportes que utilizan datos históricos para predecir cifras futuras de forma continua durante un periodo de tiempo. Las previsiones continuas se utilizan a menudo en los reportes financieros, la gestión de la cadena de suministro, la planificación y la elaboración de presupuestos. El <em>rolling forecast</em> es una ayuda esencial para tomar decisiones empresariales acertadas. Gracias a su capacidad de respuesta, las previsiones continuas ayudan a las empresas a responder más rápidamente a las condiciones cambiantes del mercado. Si se utilizan con eficacia, las previsiones continuas pueden ayudar a identificar las deficiencias de rendimiento, acortar los ciclos de planificación y tomar la mejor decisión para los resultados. Para nuestros ejemplos, nuestro horizonte de predicción será de un día</p></li>
</ul>
<p><img alt="" src="_images/rolling.ppm" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;predicted=</span><span class="si">%f</span><span class="s1">, expected=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yhat</span><span class="p">,</span> <span class="n">obs</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">yhat_1w</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=176.976096, expected=175.840000
predicted=175.907231, expected=175.460000
predicted=175.362067, expected=172.880000
predicted=172.766766, expected=173.000000
predicted=173.122573, expected=173.440000
predicted=173.353920, expected=171.100000
predicted=170.993487, expected=166.890000
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Utilizaremos ahora las funciónes creadas anteriormente para calcular el error de predicción y <code class="docutils literal notranslate"><span class="pre">linpeplot</span></code> para graficarle junto a la serie de tiempo orginal de test</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_1wl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_1w</span><span class="p">),</span> <span class="s2">&quot;week 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>MSE</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>week 1</th>
      <td>1.567638</td>
      <td>4.246473</td>
      <td>0.009043</td>
      <td>2.060697</td>
      <td>0.454093</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_1wl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yhat_1w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c36b20c8b79a15f0b33d387db72f235469e09e0e1d7db42e88a6e0d89158bcfd.png" src="_images/c36b20c8b79a15f0b33d387db72f235469e09e0e1d7db42e88a6e0d89158bcfd.png" />
</div>
</div>
</section>
<section id="ejercicio-para-entregar">
<h2>Ejercicio para entregar<a class="headerlink" href="#ejercicio-para-entregar" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Considere la serie de tiempo asociada con los futuros de la criptomoneda <strong>Bitcoin</strong> desde que comenzó a tradearse hasta la fecha del día de hoy. Utilice la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> para obtener esta serie de tiempo. Recuerde que para esto debe crear primero una cuenta, y así obtener su <strong>API Key</strong> para realizar la conexión de forma efectiva.</p></li>
<li><p>Repita <strong>TODOS</strong> los pasos indicados en esta sección para encontrar modelos <strong>ARIMA</strong> para predecir el precio de <strong>Bitcoin</strong> con los siguientes horizontes: <strong>7 días, 14 días, 21 días, 28 días</strong>. Utilizar siempre predicciones usando <em>rolling</em> con ventana de predicción continua de un día. Cualquier cantidad de pasos extra para enriqucer su anális predictivo serán aceptados siempre y cuando sean acordes con lo que indica la teoría de análisis de series de tiempo.</p></li>
<li><p>Realice una tabla de error utilizando las métricas: <code class="docutils literal notranslate"><span class="pre">MAPE,</span> <span class="pre">MAE,</span> <span class="pre">RMSE,</span> <span class="pre">MSE,</span> <span class="pre">R2</span></code>.</p></li>
<li><p>Repita el análisis desarrollado en los pasos anteriores considerando ahora el criterio de <strong>inferencia Bayesiana (BIC)</strong> para encontrar el mejor modelo <strong>ARIMA</strong> y compare los errores con aquellos obtenidos con el criterio de <strong>Akaike</strong>.</p></li>
<li><p>Escriba en cada paso las conclusiones y análisis estadísticos asociados con los resultados obtenidos. Realice un test de normalidad para los residuales obtenidos para cada predicción, en cada caso agregue las correspondientes conclusiones estadísticas. Figuras y algoritmos que no estén acompañados de una conclusión, descripción y análisis estadístico, no serán tenidas en cuenta.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="common_errors.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Errores comunes al crear visualizaciones interactivas</p>
      </div>
    </a>
    <a class="right-next"
       href="postgresql.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introducción a PostreSQL y Docker</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion-al-modelo-arima">Introducción al modelo ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementacion-del-modelo-arima">Implementación del modelo ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ejercicio-para-entregar">Ejercicio para entregar</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Lihki Rubio PhD in Mathematical Engineering
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright Department of Mathematics and Statistics.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>